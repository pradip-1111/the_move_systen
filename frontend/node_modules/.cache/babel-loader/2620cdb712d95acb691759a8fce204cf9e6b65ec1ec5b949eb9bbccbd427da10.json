{"ast":null,"code":"import _objectSpread from\"C:/Users/sarra/OneDrive - Amrita Vishwa Vidyapeetham- Chennai Campus/Desktop/movieHub2/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import{fetchMovieDetails}from'../store/slices/movieSlice';import{fetchMovieReviews,submitReview}from'../store/slices/reviewSlice';import{addToWatchlist,removeFromWatchlist,fetchWatchlist}from'../store/slices/watchlistSlice';import{verifyToken}from'../store/slices/authSlice';import LoadingSpinner from'../components/ui/LoadingSpinner';import ErrorMessage from'../components/ui/ErrorMessage';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MovieDetailPage=()=>{var _currentMovie$movie2,_currentMovie$movie3,_currentMovie$movie4,_currentMovie$movie5,_currentMovie$movie6,_currentMovie$movie7,_currentMovie$movie7$,_currentMovie$movie8,_currentMovie$movie9,_currentMovie$movie9$,_currentMovie$movie0,_currentMovie$movie1,_currentMovie$movie10,_currentMovie$movie11,_currentMovie$movie12,_currentMovie$movie13,_currentMovie$movie14;const{id}=useParams();const navigate=useNavigate();const dispatch=useDispatch();const{currentMovie,loading:movieLoading,error:movieError}=useSelector(state=>state.movies);const{reviews,loading:reviewsLoading}=useSelector(state=>state.reviews);const authState=useSelector(state=>state.auth);const{isAuthenticated,user}=authState;const{movies:watchlistMovies,loading:watchlistLoading}=useSelector(state=>state.watchlist);const isPersistRehydrated=useSelector(state=>{var _state$_persist;return(_state$_persist=state._persist)===null||_state$_persist===void 0?void 0:_state$_persist.rehydrated;});const[userReview,setUserReview]=useState({rating:5,title:'',content:'',spoilers:false});const[showReviewForm,setShowReviewForm]=useState(false);const isInWatchlist=watchlistMovies.some(movie=>movie._id===id||movie.id===id);// Debug watchlist calculation\nuseEffect(()=>{console.log('ðŸŽ¬ Watchlist calculation debug:');console.log('Current movie ID:',id);console.log('Watchlist movies:',watchlistMovies);console.log('Watchlist movie IDs:',watchlistMovies.map(m=>m._id||m.id));console.log('Is in watchlist:',isInWatchlist);},[id,watchlistMovies,isInWatchlist]);useEffect(()=>{if(id){dispatch(fetchMovieDetails(id));dispatch(fetchMovieReviews({movieId:id}));}},[dispatch,id]);// Separate effect for watchlist to ensure proper auth state handling\nuseEffect(()=>{// Only proceed if Redux Persist has rehydrated\nif(!isPersistRehydrated){console.log('â³ Waiting for Redux Persist rehydration...');return;}// Try multiple ways to get user ID for better compatibility\nconst getUserId=()=>{if(user!==null&&user!==void 0&&user._id)return user._id;if(user!==null&&user!==void 0&&user.id)return user.id;// Fallback: check localStorage for token and decode if needed\nconst token=localStorage.getItem('token');if(token&&isAuthenticated){// For now, use a more reliable approach by calling verifyToken if needed\nreturn null;// Will trigger a token verification\n}return null;};const userId=getUserId();console.log('ðŸ”„ Watchlist sync check (after rehydration):');console.log('Redux Persist rehydrated:',isPersistRehydrated);console.log('Is authenticated:',isAuthenticated);console.log('User object:',user);console.log('Resolved user ID:',userId);console.log('Watchlist loading:',watchlistLoading);if(isAuthenticated&&userId){console.log('âœ… Fetching watchlist for user:',userId);dispatch(fetchWatchlist(userId));}else if(isAuthenticated&&!userId){console.log('ðŸ”„ User authenticated but no ID, dispatching token verification...');dispatch(verifyToken()).then(result=>{var _result$payload;if(result.type==='auth/verifyToken/fulfilled'&&(_result$payload=result.payload)!==null&&_result$payload!==void 0&&_result$payload.user){const verifiedUserId=result.payload.user._id||result.payload.user.id;if(verifiedUserId){console.log('âœ… Token verified, fetching watchlist for user:',verifiedUserId);dispatch(fetchWatchlist(verifiedUserId));}}});}},[dispatch,isAuthenticated,user,isPersistRehydrated,watchlistLoading]);// Debug logging\nuseEffect(()=>{var _currentMovie$movie;console.log('Complete auth state object:',authState);console.log('Auth breakdown:',{isAuthenticated,user});console.log('User object type:',typeof user);console.log('User keys:',user?Object.keys(user):'User is falsy');console.log('User details:',user);console.log('Movie data:',currentMovie);console.log('Poster URL (direct):',currentMovie===null||currentMovie===void 0?void 0:currentMovie.posterUrl);console.log('Poster URL (nested):',currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie=currentMovie.movie)===null||_currentMovie$movie===void 0?void 0:_currentMovie$movie.posterUrl);},[authState,isAuthenticated,user,currentMovie]);const handleWatchlistToggle=()=>{console.log('Watchlist toggle clicked');console.log('Auth state:',{isAuthenticated,user:user===null||user===void 0?void 0:user._id});console.log('Movie ID:',id);console.log('Is in watchlist:',isInWatchlist);console.log('Watchlist movies:',watchlistMovies);// For testing, let's try using a dummy user ID if auth state is inconsistent\nif(!isAuthenticated||!user){console.log('Authentication issue - not authenticated or no user data');navigate('/login');return;}const userId=user._id||user.id;if(!userId){console.log('No user ID found in user object:',user);navigate('/login');return;}console.log('Using user ID:',userId);if(isInWatchlist){console.log('Removing from watchlist...');console.log('Remove payload:',{userId,movieId:id});dispatch(removeFromWatchlist({userId,movieId:id})).then(result=>{console.log('Remove result:',result);if(result.type==='watchlist/removeFromWatchlist/fulfilled'){console.log('âœ… Successfully removed from watchlist');}});}else{console.log('Adding to watchlist...');console.log('Add payload:',{userId,movieId:id});console.log('User ID type:',typeof userId);console.log('Movie ID type:',typeof id);dispatch(addToWatchlist({userId,movieId:id})).then(result=>{console.log('Add result:',result);if(result.type==='watchlist/addToWatchlist/fulfilled'){console.log('âœ… Successfully added to watchlist');// Refresh watchlist to update button state\ndispatch(fetchWatchlist(userId));}else if(result.type==='watchlist/addToWatchlist/rejected'){var _result$payload2;console.log('âŒ Failed to add to watchlist:',result.payload);// Handle \"already in watchlist\" case gracefully\nif(((_result$payload2=result.payload)===null||_result$payload2===void 0?void 0:_result$payload2.error)==='Movie already in watchlist'){console.log('ðŸ”„ Movie already in watchlist, refreshing watchlist data...');// Just refresh the watchlist to sync the frontend state\ndispatch(fetchWatchlist(userId));}}});}};const handleSubmitReview=e=>{e.preventDefault();if(!isAuthenticated){navigate('/login');return;}dispatch(submitReview({movieId:id,reviewData:userReview})).then(result=>{if(result.type==='reviews/submitReview/fulfilled'){// Reset form and close it\nsetUserReview({rating:5,title:'',content:'',spoilers:false});setShowReviewForm(false);// Refresh both reviews and movie details to update statistics\ndispatch(fetchMovieReviews({movieId:id}));dispatch(fetchMovieDetails(id));}});};if(movieLoading&&!currentMovie){return/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto px-4 py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center min-h-64\",children:/*#__PURE__*/_jsx(LoadingSpinner,{})})});}if(movieError){return/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto px-4 py-8\",children:/*#__PURE__*/_jsx(ErrorMessage,{message:typeof movieError==='string'?movieError:(movieError===null||movieError===void 0?void 0:movieError.message)||'An error occurred'})});}if(!currentMovie){return/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto px-4 py-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:\"Movie not found\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/movies'),className:\"mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\",children:\"Browse Movies\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-md overflow-hidden mb-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"md:flex\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"md:w-1/3 lg:w-1/4 relative\",children:[currentMovie!==null&&currentMovie!==void 0&&(_currentMovie$movie2=currentMovie.movie)!==null&&_currentMovie$movie2!==void 0&&_currentMovie$movie2.posterUrl?/*#__PURE__*/_jsx(\"img\",{src:currentMovie.movie.posterUrl,alt:currentMovie.movie.title,className:\"w-full h-64 md:h-full object-cover\",onError:e=>{console.log('Poster failed to load:',currentMovie.movie.posterUrl);e.target.style.display='none';e.target.nextElementSibling.style.display='flex';},onLoad:()=>{console.log('Poster loaded successfully:',currentMovie.movie.posterUrl);}}):null,/*#__PURE__*/_jsx(\"div\",{className:\"w-full h-64 md:h-full bg-gray-200 flex items-center justify-center text-gray-500 border absolute top-0\",style:currentMovie!==null&&currentMovie!==void 0&&(_currentMovie$movie3=currentMovie.movie)!==null&&_currentMovie$movie3!==void 0&&_currentMovie$movie3.posterUrl?{display:'none'}:{display:'flex'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"svg\",{className:\"w-16 h-16 mx-auto mb-2 text-gray-400\",fill:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M4 3h16l-2 4H6L4 3zm0 6h16v2H4V9zm2 4h12v6H6v-6z\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium\",children:\"No Poster Available\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"md:w-2/3 lg:w-3/4 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-start mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-2\",children:currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie4=currentMovie.movie)===null||_currentMovie$movie4===void 0?void 0:_currentMovie$movie4.title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 mb-2\",children:[currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie5=currentMovie.movie)===null||_currentMovie$movie5===void 0?void 0:_currentMovie$movie5.year,\" \\u2022 \",currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie6=currentMovie.movie)===null||_currentMovie$movie6===void 0?void 0:_currentMovie$movie6.runtime,\" min\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-4 mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-yellow-400 text-lg\",children:\"\\u2605\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-1 font-medium\",children:(currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie7=currentMovie.movie)===null||_currentMovie$movie7===void 0?void 0:(_currentMovie$movie7$=_currentMovie$movie7.averageRating)===null||_currentMovie$movie7$===void 0?void 0:_currentMovie$movie7$.toFixed(1))||'N/A'}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-500 ml-1\",children:[\"(\",(currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie8=currentMovie.movie)===null||_currentMovie$movie8===void 0?void 0:_currentMovie$movie8.totalReviews)||0,\" reviews)\"]})]})})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleWatchlistToggle,className:\"px-4 py-2 rounded-md font-medium \".concat(isInWatchlist?'bg-red-100 text-red-800 hover:bg-red-200':'bg-blue-100 text-blue-800 hover:bg-blue-200'),children:isInWatchlist?'Remove from Watchlist':'Add to Watchlist'})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2 mb-4\",children:currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie9=currentMovie.movie)===null||_currentMovie$movie9===void 0?void 0:(_currentMovie$movie9$=_currentMovie$movie9.genres)===null||_currentMovie$movie9$===void 0?void 0:_currentMovie$movie9$.map(genre=>/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-gray-100 text-gray-800 text-sm rounded-full\",children:genre},genre))}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-2\",children:\"Synopsis\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 leading-relaxed\",children:(currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie0=currentMovie.movie)===null||_currentMovie$movie0===void 0?void 0:_currentMovie$movie0.synopsis)||'No synopsis available.'})]}),((currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie1=currentMovie.movie)===null||_currentMovie$movie1===void 0?void 0:_currentMovie$movie1.director)||(currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie10=currentMovie.movie)===null||_currentMovie$movie10===void 0?void 0:(_currentMovie$movie11=_currentMovie$movie10.cast)===null||_currentMovie$movie11===void 0?void 0:_currentMovie$movie11.length)>0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[(currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie12=currentMovie.movie)===null||_currentMovie$movie12===void 0?void 0:_currentMovie$movie12.director)&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600 mb-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Director:\"}),\" \",currentMovie.movie.director]}),(currentMovie===null||currentMovie===void 0?void 0:(_currentMovie$movie13=currentMovie.movie)===null||_currentMovie$movie13===void 0?void 0:(_currentMovie$movie14=_currentMovie$movie13.cast)===null||_currentMovie$movie14===void 0?void 0:_currentMovie$movie14.length)>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Cast:\"}),\" \",currentMovie.movie.cast.join(', ')]})]})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-md p-6 mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Reviews\"}),isAuthenticated&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowReviewForm(!showReviewForm),className:\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\",children:\"Write Review\"})]}),showReviewForm&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmitReview,className:\"mb-6 p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Rating\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex space-x-2\",children:[1,2,3,4,5].map(star=>/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setUserReview(_objectSpread(_objectSpread({},userReview),{},{rating:star})),className:\"text-2xl \".concat(star<=userReview.rating?'text-yellow-400':'text-gray-300',\" hover:text-yellow-400\"),children:\"\\u2605\"},star))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Review Title\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:userReview.title,onChange:e=>setUserReview(_objectSpread(_objectSpread({},userReview),{},{title:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"Give your review a title (3-100 characters)\",minLength:3,maxLength:100,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Your Review\"}),/*#__PURE__*/_jsx(\"textarea\",{value:userReview.content,onChange:e=>setUserReview(_objectSpread(_objectSpread({},userReview),{},{content:e.target.value})),rows:4,className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",placeholder:\"Share your thoughts about this movie (10-2000 characters)\",minLength:10,maxLength:2000,required:true})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:userReview.spoilers,onChange:e=>setUserReview(_objectSpread(_objectSpread({},userReview),{},{spoilers:e.target.checked})),className:\"mr-2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-700\",children:\"This review contains spoilers\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\",children:\"Submit Review\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setShowReviewForm(false),className:\"bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400\",children:\"Cancel\"})]})]}),reviewsLoading?/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center py-8\",children:/*#__PURE__*/_jsx(LoadingSpinner,{})}):reviews&&reviews.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:reviews.map(review=>{var _review$user;return/*#__PURE__*/_jsxs(\"div\",{className:\"border-b border-gray-200 pb-4 last:border-b-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-between items-start mb-2\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:((_review$user=review.user)===null||_review$user===void 0?void 0:_review$user.username)||'Anonymous'}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex text-yellow-400\",children:[...Array(5)].map((_,i)=>/*#__PURE__*/_jsx(\"span\",{className:i<review.rating?'text-yellow-400':'text-gray-300',children:\"\\u2605\"},i))}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-500\",children:new Date(review.createdAt).toLocaleDateString()})]})]})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 leading-relaxed\",children:review.comment})]},review._id);})}):/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 py-8\",children:\"No reviews yet. Be the first to review this movie!\"})]})]});};export default MovieDetailPage;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","useDispatch","useSelector","fetchMovieDetails","fetchMovieReviews","submitReview","addToWatchlist","removeFromWatchlist","fetchWatchlist","verifyToken","LoadingSpinner","ErrorMessage","jsx","_jsx","jsxs","_jsxs","MovieDetailPage","_currentMovie$movie2","_currentMovie$movie3","_currentMovie$movie4","_currentMovie$movie5","_currentMovie$movie6","_currentMovie$movie7","_currentMovie$movie7$","_currentMovie$movie8","_currentMovie$movie9","_currentMovie$movie9$","_currentMovie$movie0","_currentMovie$movie1","_currentMovie$movie10","_currentMovie$movie11","_currentMovie$movie12","_currentMovie$movie13","_currentMovie$movie14","id","navigate","dispatch","currentMovie","loading","movieLoading","error","movieError","state","movies","reviews","reviewsLoading","authState","auth","isAuthenticated","user","watchlistMovies","watchlistLoading","watchlist","isPersistRehydrated","_state$_persist","_persist","rehydrated","userReview","setUserReview","rating","title","content","spoilers","showReviewForm","setShowReviewForm","isInWatchlist","some","movie","_id","console","log","map","m","movieId","getUserId","token","localStorage","getItem","userId","then","result","_result$payload","type","payload","verifiedUserId","_currentMovie$movie","Object","keys","posterUrl","handleWatchlistToggle","_result$payload2","handleSubmitReview","e","preventDefault","reviewData","className","children","message","onClick","src","alt","onError","target","style","display","nextElementSibling","onLoad","fill","viewBox","d","year","runtime","averageRating","toFixed","totalReviews","concat","genres","genre","synopsis","director","cast","length","join","onSubmit","star","_objectSpread","value","onChange","placeholder","minLength","maxLength","required","rows","checked","review","_review$user","username","Array","_","i","Date","createdAt","toLocaleDateString","comment"],"sources":["C:/Users/sarra/OneDrive - Amrita Vishwa Vidyapeetham- Chennai Campus/Desktop/movieHub2/frontend/src/pages/MovieDetailPage.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { fetchMovieDetails } from '../store/slices/movieSlice';\r\nimport { fetchMovieReviews, submitReview } from '../store/slices/reviewSlice';\r\nimport { addToWatchlist, removeFromWatchlist, fetchWatchlist } from '../store/slices/watchlistSlice';\r\nimport { verifyToken } from '../store/slices/authSlice';\r\nimport LoadingSpinner from '../components/ui/LoadingSpinner';\r\nimport ErrorMessage from '../components/ui/ErrorMessage';\r\n\r\nconst MovieDetailPage = () => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  \r\n  const { currentMovie, loading: movieLoading, error: movieError } = useSelector(state => state.movies);\r\n  const { reviews, loading: reviewsLoading } = useSelector(state => state.reviews);\r\n  const authState = useSelector(state => state.auth);\r\n  const { isAuthenticated, user } = authState;\r\n  const { movies: watchlistMovies, loading: watchlistLoading } = useSelector(state => state.watchlist);\r\n  const isPersistRehydrated = useSelector(state => state._persist?.rehydrated);\r\n  \r\n  const [userReview, setUserReview] = useState({ rating: 5, title: '', content: '', spoilers: false });\r\n  const [showReviewForm, setShowReviewForm] = useState(false);\r\n\r\n  const isInWatchlist = watchlistMovies.some(movie => movie._id === id || movie.id === id);\r\n  \r\n  // Debug watchlist calculation\r\n  useEffect(() => {\r\n    console.log('ðŸŽ¬ Watchlist calculation debug:');\r\n    console.log('Current movie ID:', id);\r\n    console.log('Watchlist movies:', watchlistMovies);\r\n    console.log('Watchlist movie IDs:', watchlistMovies.map(m => m._id || m.id));\r\n    console.log('Is in watchlist:', isInWatchlist);\r\n  }, [id, watchlistMovies, isInWatchlist]);\r\n\r\n  useEffect(() => {\r\n    if (id) {\r\n      dispatch(fetchMovieDetails(id));\r\n      dispatch(fetchMovieReviews({ movieId: id }));\r\n    }\r\n  }, [dispatch, id]);\r\n\r\n  // Separate effect for watchlist to ensure proper auth state handling\r\n  useEffect(() => {\r\n    // Only proceed if Redux Persist has rehydrated\r\n    if (!isPersistRehydrated) {\r\n      console.log('â³ Waiting for Redux Persist rehydration...');\r\n      return;\r\n    }\r\n\r\n    // Try multiple ways to get user ID for better compatibility\r\n    const getUserId = () => {\r\n      if (user?._id) return user._id;\r\n      if (user?.id) return user.id;\r\n      \r\n      // Fallback: check localStorage for token and decode if needed\r\n      const token = localStorage.getItem('token');\r\n      if (token && isAuthenticated) {\r\n        // For now, use a more reliable approach by calling verifyToken if needed\r\n        return null; // Will trigger a token verification\r\n      }\r\n      \r\n      return null;\r\n    };\r\n\r\n    const userId = getUserId();\r\n    \r\n    console.log('ðŸ”„ Watchlist sync check (after rehydration):');\r\n    console.log('Redux Persist rehydrated:', isPersistRehydrated);\r\n    console.log('Is authenticated:', isAuthenticated);\r\n    console.log('User object:', user);\r\n    console.log('Resolved user ID:', userId);\r\n    console.log('Watchlist loading:', watchlistLoading);\r\n    \r\n    if (isAuthenticated && userId) {\r\n      console.log('âœ… Fetching watchlist for user:', userId);\r\n      dispatch(fetchWatchlist(userId));\r\n    } else if (isAuthenticated && !userId) {\r\n      console.log('ðŸ”„ User authenticated but no ID, dispatching token verification...');\r\n      dispatch(verifyToken()).then((result) => {\r\n        if (result.type === 'auth/verifyToken/fulfilled' && result.payload?.user) {\r\n          const verifiedUserId = result.payload.user._id || result.payload.user.id;\r\n          if (verifiedUserId) {\r\n            console.log('âœ… Token verified, fetching watchlist for user:', verifiedUserId);\r\n            dispatch(fetchWatchlist(verifiedUserId));\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }, [dispatch, isAuthenticated, user, isPersistRehydrated, watchlistLoading]);\r\n\r\n  // Debug logging\r\n  useEffect(() => {\r\n    console.log('Complete auth state object:', authState);\r\n    console.log('Auth breakdown:', { isAuthenticated, user });\r\n    console.log('User object type:', typeof user);\r\n    console.log('User keys:', user ? Object.keys(user) : 'User is falsy');\r\n    console.log('User details:', user);\r\n    console.log('Movie data:', currentMovie);\r\n    console.log('Poster URL (direct):', currentMovie?.posterUrl);\r\n    console.log('Poster URL (nested):', currentMovie?.movie?.posterUrl);\r\n  }, [authState, isAuthenticated, user, currentMovie]);\r\n\r\n  const handleWatchlistToggle = () => {\r\n    console.log('Watchlist toggle clicked');\r\n    console.log('Auth state:', { isAuthenticated, user: user?._id });\r\n    console.log('Movie ID:', id);\r\n    console.log('Is in watchlist:', isInWatchlist);\r\n    console.log('Watchlist movies:', watchlistMovies);\r\n    \r\n    // For testing, let's try using a dummy user ID if auth state is inconsistent\r\n    if (!isAuthenticated || !user) {\r\n      console.log('Authentication issue - not authenticated or no user data');\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    const userId = user._id || user.id;\r\n    if (!userId) {\r\n      console.log('No user ID found in user object:', user);\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    console.log('Using user ID:', userId);\r\n\r\n    if (isInWatchlist) {\r\n      console.log('Removing from watchlist...');\r\n      console.log('Remove payload:', { userId, movieId: id });\r\n      dispatch(removeFromWatchlist({ userId, movieId: id })).then((result) => {\r\n        console.log('Remove result:', result);\r\n        if (result.type === 'watchlist/removeFromWatchlist/fulfilled') {\r\n          console.log('âœ… Successfully removed from watchlist');\r\n        }\r\n      });\r\n    } else {\r\n      console.log('Adding to watchlist...');\r\n      console.log('Add payload:', { userId, movieId: id });\r\n      console.log('User ID type:', typeof userId);\r\n      console.log('Movie ID type:', typeof id);\r\n      dispatch(addToWatchlist({ userId, movieId: id })).then((result) => {\r\n        console.log('Add result:', result);\r\n        if (result.type === 'watchlist/addToWatchlist/fulfilled') {\r\n          console.log('âœ… Successfully added to watchlist');\r\n          // Refresh watchlist to update button state\r\n          dispatch(fetchWatchlist(userId));\r\n        } else if (result.type === 'watchlist/addToWatchlist/rejected') {\r\n          console.log('âŒ Failed to add to watchlist:', result.payload);\r\n          \r\n          // Handle \"already in watchlist\" case gracefully\r\n          if (result.payload?.error === 'Movie already in watchlist') {\r\n            console.log('ðŸ”„ Movie already in watchlist, refreshing watchlist data...');\r\n            // Just refresh the watchlist to sync the frontend state\r\n            dispatch(fetchWatchlist(userId));\r\n          }\r\n        }\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleSubmitReview = (e) => {\r\n    e.preventDefault();\r\n    if (!isAuthenticated) {\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    dispatch(submitReview({\r\n      movieId: id,\r\n      reviewData: userReview\r\n    })).then((result) => {\r\n      if (result.type === 'reviews/submitReview/fulfilled') {\r\n        // Reset form and close it\r\n        setUserReview({ rating: 5, title: '', content: '', spoilers: false });\r\n        setShowReviewForm(false);\r\n        \r\n        // Refresh both reviews and movie details to update statistics\r\n        dispatch(fetchMovieReviews({ movieId: id }));\r\n        dispatch(fetchMovieDetails(id));\r\n      }\r\n    });\r\n  };\r\n\r\n  if (movieLoading && !currentMovie) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"flex justify-center items-center min-h-64\">\r\n          <LoadingSpinner />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (movieError) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <ErrorMessage message={typeof movieError === 'string' ? movieError : movieError?.message || 'An error occurred'} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!currentMovie) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"text-center\">\r\n          <h1 className=\"text-2xl font-bold text-gray-900\">Movie not found</h1>\r\n          <button\r\n            onClick={() => navigate('/movies')}\r\n            className=\"mt-4 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\"\r\n          >\r\n            Browse Movies\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"container mx-auto px-4 py-8\">\r\n      {/* Movie Header */}\r\n      <div className=\"bg-white rounded-lg shadow-md overflow-hidden mb-8\">\r\n        <div className=\"md:flex\">\r\n          {/* Movie Poster */}\r\n          <div className=\"md:w-1/3 lg:w-1/4 relative\">\r\n            {currentMovie?.movie?.posterUrl ? (\r\n              <img\r\n                src={currentMovie.movie.posterUrl}\r\n                alt={currentMovie.movie.title}\r\n                className=\"w-full h-64 md:h-full object-cover\"\r\n                onError={(e) => {\r\n                  console.log('Poster failed to load:', currentMovie.movie.posterUrl);\r\n                  e.target.style.display = 'none';\r\n                  e.target.nextElementSibling.style.display = 'flex';\r\n                }}\r\n                onLoad={() => {\r\n                  console.log('Poster loaded successfully:', currentMovie.movie.posterUrl);\r\n                }}\r\n              />\r\n            ) : null}\r\n            <div\r\n              className=\"w-full h-64 md:h-full bg-gray-200 flex items-center justify-center text-gray-500 border absolute top-0\"\r\n              style={currentMovie?.movie?.posterUrl ? { display: 'none' } : { display: 'flex' }}\r\n            >\r\n              <div className=\"text-center\">\r\n                <svg className=\"w-16 h-16 mx-auto mb-2 text-gray-400\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path d=\"M4 3h16l-2 4H6L4 3zm0 6h16v2H4V9zm2 4h12v6H6v-6z\"/>\r\n                </svg>\r\n                <div className=\"text-sm font-medium\">No Poster Available</div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Movie Info */}\r\n          <div className=\"md:w-2/3 lg:w-3/4 p-6\">\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">{currentMovie?.movie?.title}</h1>\r\n                <p className=\"text-gray-600 mb-2\">{currentMovie?.movie?.year} â€¢ {currentMovie?.movie?.runtime} min</p>\r\n                <div className=\"flex items-center space-x-4 mb-4\">\r\n                  <div className=\"flex items-center\">\r\n                    <span className=\"text-yellow-400 text-lg\">â˜…</span>\r\n                    <span className=\"ml-1 font-medium\">{currentMovie?.movie?.averageRating?.toFixed(1) || 'N/A'}</span>\r\n                    <span className=\"text-gray-500 ml-1\">({currentMovie?.movie?.totalReviews || 0} reviews)</span>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              \r\n              <button\r\n                onClick={handleWatchlistToggle}\r\n                className={`px-4 py-2 rounded-md font-medium ${\r\n                  isInWatchlist\r\n                    ? 'bg-red-100 text-red-800 hover:bg-red-200'\r\n                    : 'bg-blue-100 text-blue-800 hover:bg-blue-200'\r\n                }`}\r\n              >\r\n                {isInWatchlist ? 'Remove from Watchlist' : 'Add to Watchlist'}\r\n              </button>\r\n            </div>\r\n            \r\n            {/* Genres */}\r\n            <div className=\"flex flex-wrap gap-2 mb-4\">\r\n              {currentMovie?.movie?.genres?.map(genre => (\r\n                <span\r\n                  key={genre}\r\n                  className=\"px-2 py-1 bg-gray-100 text-gray-800 text-sm rounded-full\"\r\n                >\r\n                  {genre}\r\n                </span>\r\n              ))}\r\n            </div>\r\n            \r\n            {/* Synopsis */}\r\n            <div>\r\n              <h3 className=\"text-lg font-semibold mb-2\">Synopsis</h3>\r\n              <p className=\"text-gray-700 leading-relaxed\">\r\n                {currentMovie?.movie?.synopsis || 'No synopsis available.'}\r\n              </p>\r\n            </div>\r\n            \r\n            {/* Cast & Crew */}\r\n            {(currentMovie?.movie?.director || currentMovie?.movie?.cast?.length > 0) && (\r\n              <div className=\"mt-4\">\r\n                {currentMovie?.movie?.director && (\r\n                  <p className=\"text-sm text-gray-600 mb-1\">\r\n                    <span className=\"font-medium\">Director:</span> {currentMovie.movie.director}\r\n                  </p>\r\n                )}\r\n                {currentMovie?.movie?.cast?.length > 0 && (\r\n                  <p className=\"text-sm text-gray-600\">\r\n                    <span className=\"font-medium\">Cast:</span> {currentMovie.movie.cast.join(', ')}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Reviews Section */}\r\n      <div className=\"bg-white rounded-lg shadow-md p-6 mb-8\">\r\n        <div className=\"flex justify-between items-center mb-6\">\r\n          <h2 className=\"text-2xl font-bold text-gray-900\">Reviews</h2>\r\n          {isAuthenticated && (\r\n            <button\r\n              onClick={() => setShowReviewForm(!showReviewForm)}\r\n              className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\"\r\n            >\r\n              Write Review\r\n            </button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Review Form */}\r\n        {showReviewForm && (\r\n          <form onSubmit={handleSubmitReview} className=\"mb-6 p-4 bg-gray-50 rounded-lg\">\r\n            <div className=\"mb-4\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Rating</label>\r\n              <div className=\"flex space-x-2\">\r\n                {[1, 2, 3, 4, 5].map(star => (\r\n                  <button\r\n                    key={star}\r\n                    type=\"button\"\r\n                    onClick={() => setUserReview({ ...userReview, rating: star })}\r\n                    className={`text-2xl ${\r\n                      star <= userReview.rating ? 'text-yellow-400' : 'text-gray-300'\r\n                    } hover:text-yellow-400`}\r\n                  >\r\n                    â˜…\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"mb-4\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Review Title</label>\r\n              <input\r\n                type=\"text\"\r\n                value={userReview.title}\r\n                onChange={(e) => setUserReview({ ...userReview, title: e.target.value })}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                placeholder=\"Give your review a title (3-100 characters)\"\r\n                minLength={3}\r\n                maxLength={100}\r\n                required\r\n              />\r\n            </div>\r\n            \r\n            <div className=\"mb-4\">\r\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Your Review</label>\r\n              <textarea\r\n                value={userReview.content}\r\n                onChange={(e) => setUserReview({ ...userReview, content: e.target.value })}\r\n                rows={4}\r\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\r\n                placeholder=\"Share your thoughts about this movie (10-2000 characters)\"\r\n                minLength={10}\r\n                maxLength={2000}\r\n                required\r\n              />\r\n            </div>\r\n            \r\n            <div className=\"mb-4\">\r\n              <label className=\"flex items-center\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={userReview.spoilers}\r\n                  onChange={(e) => setUserReview({ ...userReview, spoilers: e.target.checked })}\r\n                  className=\"mr-2\"\r\n                />\r\n                <span className=\"text-sm text-gray-700\">This review contains spoilers</span>\r\n              </label>\r\n            </div>\r\n            \r\n            <div className=\"flex space-x-3\">\r\n              <button\r\n                type=\"submit\"\r\n                className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700\"\r\n              >\r\n                Submit Review\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowReviewForm(false)}\r\n                className=\"bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400\"\r\n              >\r\n                Cancel\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {/* Reviews List */}\r\n        {reviewsLoading ? (\r\n          <div className=\"flex justify-center py-8\">\r\n            <LoadingSpinner />\r\n          </div>\r\n        ) : reviews && reviews.length > 0 ? (\r\n          <div className=\"space-y-4\">\r\n            {reviews.map(review => (\r\n              <div key={review._id} className=\"border-b border-gray-200 pb-4 last:border-b-0\">\r\n                <div className=\"flex justify-between items-start mb-2\">\r\n                  <div>\r\n                    <h4 className=\"font-medium text-gray-900\">{review.user?.username || 'Anonymous'}</h4>\r\n                    <div className=\"flex items-center space-x-2\">\r\n                      <div className=\"flex text-yellow-400\">\r\n                        {[...Array(5)].map((_, i) => (\r\n                          <span key={i} className={i < review.rating ? 'text-yellow-400' : 'text-gray-300'}>\r\n                            â˜…\r\n                          </span>\r\n                        ))}\r\n                      </div>\r\n                      <span className=\"text-sm text-gray-500\">\r\n                        {new Date(review.createdAt).toLocaleDateString()}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                <p className=\"text-gray-700 leading-relaxed\">{review.comment}</p>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-center text-gray-500 py-8\">\r\n            No reviews yet. Be the first to review this movie!\r\n          </p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MovieDetailPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}